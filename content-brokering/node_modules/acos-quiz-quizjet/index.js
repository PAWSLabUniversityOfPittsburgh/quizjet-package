//---------  Credentials --------//
var host = ""
var user = ""
var password = ""
var database = ""
//---------  End of Credentials --------//


//---------  Do not edit below this point --------//



var htmlencode = require('htmlencode').htmlEncode;

var Annotated = function() {};

Annotated.addToHead = function(params) {
    return '';
};

Annotated.addToBody = function(params) {
    return '<div class="annotated-example" data-id="' + htmlencode(params.name) + '"></div>';
};

Annotated.initialize = function(req, params, handlers, cb) {

    // Initialize the content package
    params.headContent += Annotated.addToHead(params);
    params.bodyContent += Annotated.addToBody(params);

    cb();

};

Annotated.register = function(handlers) {
    handlers.contentPackages['quizjet'] = Annotated;
    handlers.contentTypes.quiz.installedContentPackages.push(Annotated);
};

Annotated.namespace = 'quizjet';
Annotated.contentTypeNamespace = 'quiz';






////-------------- Content Brokering Section -----------------//

var mysql = require('mysql');

var conn2 = mysql.createConnection({
    host: host,
    user: user,
    password: password,
    database: database
    }
);

//Records with code and comments
var queryString_java = "SELECT webex21.ent_jquiz.rdfID as rdfid "
    + "FROM webex21.ent_jquiz "
    + "WHERE webex21.ent_jquiz.Privacy = '1';"
    //+ "AND webex21.ent_dissection.domain='py';"

conn2.query(queryString_java, function (error,rows,fields) {
    if (error) {
        throw error;
    }
    else {
        var data = JSON.stringify(rows);
        data = JSON.parse(data);
        //console.log(data);
        //console.log('\n');

        conn2.end();

        var quizjet = {};

        var prev_rdfid = "";
        var subitems = [];
        for(var i = 0; i < data.length; i++) {
            var rdfid = data[i].rdfid;
            var line = data[i].line;
            var domain = data[i].domain
            //console.log(domain);


            var rdfid = data[i].rdfid;
            var title = data[i].title
            quizjet[rdfid] = {}
            quizjet[rdfid].title = data[i].rdfid;
            quizjet[rdfid].description = 'This is an example';
            quizjet[rdfid].author = 'PAWS Lab';
            quizjet[rdfid].version = '0.1';
            quizjet[rdfid].created = '2015-11-15 00:00:00';
            quizjet[rdfid].modified = '2016-02-15 00:00:00';
            quizjet[rdfid].keywords = [title,'quizjet'];
            quizjet[rdfid].subitems = [];
            //quizjet[rdfid].subitems.push({"code":data[i].code,"comment":data[i].comment,"line":data[i].line});

            //prev_rdfid = rdfid;
            //End Java

        }

        //console.log(annotated);



        Annotated.meta = {
            'name': 'quizjet',
            'java': 'quizjet',
            'title': 'Java Quizzes',
            'shortDescription': 'A demonstration for interactive Java Quizzes',
            'description': '',
            'author': 'PAWS Lab',
            'license': 'MIT',
            'version': '0.1',
            'created': '2015-08-05 13:26:48',
            'modified': '2015-08-05 13:26:48',
            'keywords': ['quizjet', 'java', 'questions'],
            'url': '',
            'teaserContent' : ['demo'],
            'contents2': {
                'demo': {
                    'description': '',
                    'order': 0,
                    'title': 'Demo'
                }
            }
        };

        Annotated.meta.quizjet = quizjet;
        //console.log(annotated_py);


    }
});




module.exports = Annotated;